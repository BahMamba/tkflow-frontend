<div class="p-4 max-w-4xl mx-auto">
  <h1 class="text-2xl font-bold mb-4 text-center">Mes Tâches</h1>

  <!-- Recherche et filtres -->
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-4">
    <input
      type="text"
      placeholder="Rechercher..."
      [(ngModel)]="search"
      (ngModelChange)="onSearchChange($event)"
      class="p-2 border rounded-md w-full sm:w-1/3"
    />
    <select [(ngModel)]="statusFilter" (change)="onFilterChange()" class="p-2 border rounded-md" title="Filtrer par statut" aria-label="Filtrer par statut">
      <option value="">Tous les statuts</option>
      <option value="todo">À faire</option>
      <option value="in_progress">En cours</option>
      <option value="done">Terminé</option>
    </select>
    <select [(ngModel)]="priorityFilter" (change)="onFilterChange()" class="p-2 border rounded-md" title="Filtrer par priorité" aria-label="Filtrer par priorité">
      <option value="">Toutes les priorités</option>
      <option value="low">Basse</option>
      <option value="medium">Moyenne</option>
      <option value="high">Haute</option>
    </select>
  </div>

  <!-- Liste des tâches -->
  <div *ngIf="loading" class="text-center py-4">Chargement...</div>
  <div *ngIf="!loading && tasks.length === 0" class="text-center py-4 text-gray-500">Aucune tâche trouvée.</div>

  <ul *ngIf="!loading && tasks.length > 0" class="space-y-2">
    <li
      *ngFor="let task of tasks"
      class="flex justify-between items-center p-4 border rounded-md hover:shadow-md transition-shadow bg-white"
    >
      <div>
        <h2 class="font-semibold text-lg">{{ task.title }}</h2>
        <p class="text-gray-600">{{ task.description }}</p>
        <div class="flex gap-2 mt-1">
          <span
            class="px-2 py-1 rounded text-white text-xs"
            [ngClass]="{
              'bg-blue-500': task.status === 'todo',
              'bg-yellow-500': task.status === 'in_progress',
              'bg-green-500': task.status === 'done'
            }"
          >
            {{ task.status }}
          </span>
          <span
            class="px-2 py-1 rounded text-white text-xs"
            [ngClass]="{
              'bg-gray-400': task.priority === 'low',
              'bg-indigo-500': task.priority === 'medium',
              'bg-red-500': task.priority === 'high'
            }"
          >
            {{ task.priority }}
          </span>
        </div>
      </div>
      <button
        class="text-red-600 hover:text-red-800"
        (click)="deleteTask(task.id)"
        title="Supprimer la tâche"
      >
        ✖
      </button>
    </li>
  </ul>

  <!-- Pagination simple -->
  <div class="flex justify-center mt-4 gap-2">
    <button
      [disabled]="page === 1"
      (click)="changePage(page - 1)"
      class="px-3 py-1 border rounded disabled:opacity-50"
    >
      Précédent
    </button>
    <span class="px-3 py-1 border rounded bg-gray-100">{{ page }}</span>
    <button
      [disabled]="tasks.length < pageSize"
      (click)="changePage(page + 1)"
      class="px-3 py-1 border rounded disabled:opacity-50"
    >
      Suivant
    </button>
  </div>
</div>
